<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<window xmlns="http://jmix.io/schema/ui/window"
        xmlns:c="http://jmix.io/schema/ui/jpql-condition"
        caption="msg://orderBrowse.caption"
        focusComponent="confirmedOrdersTable">
    <data readOnly="true">
        <collection id="confirmedOrdersDc"
                    class="io.jmix.bookstore.order.entity.Order">
            <fetchPlan extends="_base">
                <property name="fulfilledBy" fetchPlan="_base"/>
            </fetchPlan>
            <loader id="confirmedOrdersDl">
                <query>
                    <![CDATA[select e from bookstore_Order e]]>
                    <condition>
                        <and>
                            <c:jpql>
                                <c:where><![CDATA[e.status <> 'NEW']]></c:where>
                            </c:jpql>
                        </and>
                    </condition>
                </query>
            </loader>
        </collection>
        <collection id="newOrdersDc"
                    class="io.jmix.bookstore.order.entity.Order">
            <fetchPlan extends="_base">
                <property name="fulfilledBy" fetchPlan="_base"/>
            </fetchPlan>
            <loader id="newOrdersDl">
                <query>
                    <![CDATA[select e from bookstore_Order e where e.status = 'NEW']]>
                </query>
            </loader>
        </collection>

        <collection id="fulfillmentCentersDc"
                    class="io.jmix.bookstore.fulfillment.FulfillmentCenter">
            <fetchPlan extends="_base">
                <property name="region" fetchPlan="_base"/>
            </fetchPlan>
            <loader id="fulfillmentCentersDl">
                <query>
                    <![CDATA[select e from bookstore_FulfillmentCenter e]]>
                </query>
            </loader>
        </collection>
    </data>
    <facets>
        <dataLoadCoordinator auto="true"/>
        <screenSettings id="settingsFacet" auto="true"/>
        <notification id="orderConfirmedNotification" type="HUMANIZED" caption="msg://orderConfirmed" />
    </facets>
    <actions>
        <action id="lookupSelectAction"
                caption="msg:///actions.Select"
                icon="LOOKUP_OK"
                primary="true"
                shortcut="${COMMIT_SHORTCUT}"/>
        <action id="lookupCancelAction"
                caption="msg:///actions.Cancel"
                icon="LOOKUP_CANCEL"/>
    </actions>
    <dialogMode height="600"
                width="800"/>
    <layout expand="contentTabSheet" spacing="true">
        <tabSheet id="contentTabSheet" width="100%" stylename="centered-tabs icons-on-top">

            <tab id="newOrdersTab" caption="msg://newOrders" spacing="true" margin="true" icon="font-icon:CERTIFICATE" expand="newOrdersTable">

                <groupBox id="filterGroupBox" orientation="horizontal" align="MIDDLE_CENTER" width="75%" caption="msg://newOrdersFilter" icon="SEARCH">
                    <propertyFilter property="customer"
                                    operation="EQUAL"
                                    operationEditable="true"
                                    dataLoader="newOrdersDl">
                        <entitySuggestionField id="customerField"
                                               metaClass="bookstore_Customer"
                                               inputPrompt="Search for Customer"
                                               width="100%">
                            <actions>
                                <action id="lookup" type="entity_lookup"/>
                                <action id="clear" type="entity_clear"/>
                            </actions>
                            <query entityClass="io.jmix.bookstore.customer.Customer"
                                   escapeValueForLike="true"
                                   searchStringFormat="%${searchString}%">
                                select c from bookstore_Customer c where
                                lower(c.firstName) like lower(:searchString) escape '\' or
                                lower(c.lastName) like lower(:searchString) escape '\'
                            </query>
                        </entitySuggestionField>
                    </propertyFilter>
                    <propertyFilter
                                    property="orderDate"
                                    operationEditable="true"
                                    operation="EQUAL"
                                    dataLoader="newOrdersDl"/>

                </groupBox>
                <dataGrid id="newOrdersTable"
                          width="100%"
                          dataContainer="newOrdersDc">
                    <actions>
                        <action id="create" type="create"/>
                        <action id="edit" type="edit"/>
                        <action id="confirm" icon="font-icon:CHECK_CIRCLE" caption="msg://confirmOrder" trackSelection="true"/>
                    </actions>
                    <columns>
                        <column property="orderDate" id="orderDate"/>
                        <column property="customer" id="customer"/>
                    </columns>
                    <simplePagination/>
                    <buttonsPanel id="newOrdersButtonsPanel"
                                  alwaysVisible="true">
                        <button id="newOrdersTableCreateBtn" action="newOrdersTable.create"/>
                        <button id="confirmBtn" action="newOrdersTable.confirm"/>
                    </buttonsPanel>
                </dataGrid>
            </tab>

            <tab id="confirmedOrdersTab" caption="msg://confirmedOrders" spacing="true" margin="true" icon="font-icon:CHECK_CIRCLE" expand="confirmedOrdersTable">
                <filter id="filter"
                        dataLoader="confirmedOrdersDl">
                    <properties include=".*"/>
                </filter>
                <dataGrid id="confirmedOrdersTable"
                          width="100%"
                          dataContainer="confirmedOrdersDc">
                    <actions>
                        <action id="edit" type="edit"/>
                        <action id="remove" type="remove"/>
                        <action id="trackDelivery" caption="msg://trackDelivery" icon="TRUCK" trackSelection="true"/>
                    </actions>
                    <columns>
                        <column property="orderDate" id="orderDate"/>
                        <column property="customer" id="customer"/>
                        <column property="shippingDate" id="shippingDate"/>
                        <column property="status" id="status"/>
                        <column property="fulfilledBy" id="fulfilledBy"/>
                    </columns>
                    <simplePagination/>
                    <buttonsPanel id="buttonsPanel"
                                  alwaysVisible="true">
                        <button id="editBtn" action="confirmedOrdersTable.edit"/>
                        <button id="removeBtn" action="confirmedOrdersTable.remove"/>
                        <button id="trackDeliveryBtn" action="confirmedOrdersTable.trackDelivery"/>
                    </buttonsPanel>
                </dataGrid>
            </tab>
        </tabSheet>
        <hbox id="lookupActions" spacing="true" visible="false">
            <button action="lookupSelectAction"/>
            <button action="lookupCancelAction"/>
        </hbox>
    </layout>
</window>
